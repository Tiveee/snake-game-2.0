<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–º–µ–π–∫–∞ 2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            transition: background 0.5s ease;
            overflow-x: hidden;
        }
        
        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ–Ω—ã */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.7;
            animation: float linear infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
            height: 100%;
        }
        
        .header-buttons {
            position: fixed;
            top: 20px;
            width: 100%;
            max-width: 500px;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }
        
        .coin-display {
            background: rgba(0, 0, 0, 0.7);
            color: gold;
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid gold;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .nickname-display {
            background: rgba(0, 0, 0, 0.7);
            color: #4cc9f0;
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #4cc9f0;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 70px 0 20px;
            overflow-y: auto;
            max-height: calc(100vh - 90px);
        }
        
        #mainMenu {
            display: flex;
        }
        
        .game-title-section {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            border: 2px solid #4CAF50;
        }
        
        .game-title {
            font-size: 36px;
            color: #4CAF50;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
        }
        
        .menu-section {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #4cc9f0;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            width: 100%;
            backdrop-filter: blur(10px);
        }
        
        .section-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #4cc9f0;
            text-align: center;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 18px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-large {
            font-size: 22px;
            padding: 18px;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .skin-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }
        
        .nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .skin-preview {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .skin-sample {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .skin-sample:hover {
            transform: scale(1.2);
        }
        
        .skin-selected {
            border-color: #4cc9f0;
            transform: scale(1.2);
        }
        
        .skin-info {
            text-align: center;
            margin: 15px 0;
        }
        
        .skin-info h3 {
            color: #4cc9f0;
            margin-bottom: 5px;
        }
        
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        
        .shop-item {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #4cc9f0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
        }
        
        .shop-item-price {
            color: gold;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .food-preview {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .food-sample {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .language-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .lang-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #4cc9f0;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .lang-btn:hover {
            background: rgba(76, 201, 240, 0.2);
        }
        
        .lang-selected {
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
        }
        
        .game-stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-bottom: 10px;
        }
        
        .stat-box {
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 10px;
            border: 2px solid #4cc9f0;
            font-size: 16px;
            text-align: center;
            flex: 1;
            margin: 0 5px;
        }
        
        .game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
        }
        
        .canvas-container {
            position: relative;
            width: 100%;
            max-width: 400px;
        }
        
        canvas {
            width: 100%;
            height: auto;
            border: 3px solid #4cc9f0;
            border-radius: 10px;
            background-color: rgba(15, 52, 96, 0.8);
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.3);
            display: block;
        }
        
        .controls {
            display: grid;
            grid-template-areas: 
                ". up ."
                "left . right"
                ". down .";
            gap: 10px;
            margin-top: 10px;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            font-size: 24px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .control-btn:active {
            transform: translateY(0);
        }
        
        #up { grid-area: up; }
        #left { grid-area: left; }
        #right { grid-area: right; }
        #down { grid-area: down; }
        
        .keyboard-hint {
            text-align: center;
            font-size: 14px;
            color: #4cc9f0;
            margin-top: 5px;
        }
        
        .game-over, .pause-screen, .win-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            text-align: center;
        }
        
        .game-over h2, .pause-screen h2, .win-screen h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }
        
        .game-over h2 { color: #ff5252; }
        .pause-screen h2 { color: #4cc9f0; }
        .win-screen h2 { color: #4caf50; }
        
        .game-over p, .pause-screen p, .win-screen p {
            font-size: 24px;
            margin-bottom: 30px;
        }
        
        .menu-btn {
            padding: 12px 25px;
            margin: 10px;
            font-size: 18px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .menu-btn:hover {
            transform: scale(1.05);
        }
        
        .back-btn {
            position: absolute;
            top: 70px;
            left: 10px;
            padding: 8px 16px;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 2px solid #4cc9f0;
            border-radius: 8px;
            cursor: pointer;
            z-index: 10;
        }
        
        .field-size-option {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .size-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #4cc9f0;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .size-btn:hover {
            background: rgba(76, 201, 240, 0.2);
        }
        
        .size-selected {
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .slider {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            border-radius: 4px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #4cc9f0;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }
        
        .volume-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .promocode-section {
            margin-top: 20px;
            text-align: center;
        }
        
        .promocode-input {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #4cc9f0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .nickname-input {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #4cc9f0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .shop-details {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            border: 2px solid #4cc9f0;
        }
        
        .shop-details h3 {
            color: #4cc9f0;
            margin-bottom: 10px;
        }
        
        .shop-details p {
            margin-bottom: 15px;
        }
        
        .leaderboard {
            width: 100%;
            margin: 15px 0;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #4cc9f0;
        }
        
        .leaderboard-position {
            font-weight: bold;
            color: #4cc9f0;
            min-width: 30px;
        }
        
        .leaderboard-name {
            flex: 1;
            text-align: left;
            padding: 0 10px;
        }
        
        .leaderboard-score {
            font-weight: bold;
            color: gold;
            min-width: 60px;
            text-align: right;
        }
        
        .profile-info {
            text-align: center;
            margin: 15px 0;
        }
        
        .profile-stat {
            font-size: 18px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .profile-stat span {
            color: #4cc9f0;
        }
        
        .snake-preview {
            width: 200px;
            height: 40px;
            margin: 15px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .snake-segment {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            position: absolute;
        }
        
        .snake-head {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            z-index: 10;
        }
        
        .timer {
            font-size: 24px;
            color: #ff5252;
            font-weight: bold;
        }
        
        .mobile-controls {
            display: none;
        }
        
        .shop-coin-display {
            background: rgba(0, 0, 0, 0.7);
            color: gold;
            padding: 10px 15px;
            border-radius: 10px;
            border: 2px solid gold;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        @media (max-width: 768px) {
            .screen {
                padding: 70px 0 10px;
                max-height: calc(100vh - 80px);
            }
            
            .game-title {
                font-size: 32px;
            }
            
            .controls {
                gap: 8px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .menu-section {
                padding: 15px;
            }
            
            .btn {
                padding: 12px;
                font-size: 16px;
            }
            
            .btn-large {
                font-size: 18px;
                padding: 15px;
            }
            
            .shop-grid {
                grid-template-columns: 1fr;
            }
            
            .mobile-controls {
                display: grid;
            }
            
            .game-stats {
                flex-wrap: wrap;
            }
            
            .stat-box {
                flex: 1 0 45%;
                margin-bottom: 5px;
            }
        }
        
        @media (max-width: 400px) {
            body {
                padding: 10px;
            }
            
            .game-title {
                font-size: 28px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .header-buttons {
                padding: 0 10px;
            }
        }
    </style>
</head>
<body>
    <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω -->
    <div class="background-animation" id="backgroundAnimation"></div>
    
    <div class="container">
        <!-- –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤–≤–µ—Ä—Ö—É —ç–∫—Ä–∞–Ω–∞ -->
        <div class="header-buttons">
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="showScreen('shopScreen')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
                <div class="coin-display">üí∞ <span id="coinCount">0</span></div>
                <div class="nickname-display" id="nicknameDisplay" onclick="showScreen('profileScreen')">–ò–≥—Ä–æ–∫</div>
            </div>
            <button class="btn" onclick="showScreen('settingsScreen')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="mainMenu" class="screen">
            <div class="game-title-section">
                <h1 class="game-title">–ó–ú–ï–ô–ö–ê 2.0</h1>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–†–µ–∂–∏–º—ã –∏–≥—Ä—ã</h2>
                <button class="btn btn-large" onclick="startGame('endless')">
                    ‚ôæÔ∏è –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ–∂–∏–º
                </button>
                <button class="btn btn-large" onclick="startGame('target')">
                    üèÜ –†–µ–∂–∏–º –Ω–∞ –æ—á–∫–∏
                </button>
                <button class="btn btn-large" id="timedModeBtn" onclick="startGame('timed')" disabled>
                    ‚è±Ô∏è –†–µ–∂–∏–º –Ω–∞ –≤—Ä–µ–º—è
                </button>
                <button class="btn btn-large" onclick="showScreen('leaderboardScreen')">
                    üìä –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
                </button>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h2>
                <button class="btn" onclick="showScreen('skinsScreen')">
                    üêç –í—ã–±–æ—Ä —Å–∫–∏–Ω–∞
                </button>
                <button class="btn" onclick="showScreen('backgroundsScreen')">
                    üé® –í—ã–±–æ—Ä —Ñ–æ–Ω–∞
                </button>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Å–∫–∏–Ω–æ–≤ -->
        <div id="skinsScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 class="title">–í—ã–±–æ—Ä —Å–∫–∏–Ω–∞</h1>
            
            <div class="menu-section">
                <h2 class="section-title">–°–∫–∏–Ω—ã –∑–º–µ–π–∫–∏</h2>
                <div class="skin-navigation">
                    <button class="nav-btn" onclick="navigateSkin(-1)">‚Üê</button>
                    <div class="snake-preview" id="snakePreview"></div>
                    <button class="nav-btn" onclick="navigateSkin(1)">‚Üí</button>
                </div>
                <div class="skin-info">
                    <h3 id="skinName">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π</h3>
                    <p id="skinDescription">–ó–µ–ª–µ–Ω–∞—è –∑–º–µ–π–∫–∞ —Å —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º</p>
                </div>
                <button class="btn" onclick="applySkin()" id="skinApplyBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–∫–∏–Ω</button>
                <button class="btn" onclick="showScreen('shopScreen')">üõí –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</button>
            </div>
        </div>
        
        <!-- –ú–∞–≥–∞–∑–∏–Ω -->
        <div id="shopScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 class="title">–ú–∞–≥–∞–∑–∏–Ω</h1>
            
            <div class="shop-coin-display">
                üí∞ –ú–æ–Ω–µ—Ç—ã: <span id="shopCoinCount">0</span>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–†–µ–∂–∏–º—ã –∏–≥—Ä—ã</h2>
                <div class="shop-grid">
                    <div class="shop-item" onclick="showShopDetails('timedMode')">
                        <h3>‚è±Ô∏è –†–µ–∂–∏–º –Ω–∞ –≤—Ä–µ–º—è</h3>
                        <p>–°–æ–±–µ—Ä–∏ –º–∞–∫—Å–∏–º—É–º –µ–¥—ã –∑–∞ 60 —Å–µ–∫—É–Ω–¥</p>
                        <div class="shop-item-price">50 üí∞</div>
                    </div>
                </div>
                <div class="shop-details" id="timedModeDetails">
                    <h3>‚è±Ô∏è –†–µ–∂–∏–º –Ω–∞ –≤—Ä–µ–º—è</h3>
                    <p>–°–æ–±–µ—Ä–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –µ–¥—ã –∑–∞ 60 —Å–µ–∫—É–Ω–¥! –ö–∞–∂–¥–∞—è —Å—ä–µ–¥–µ–Ω–Ω–∞—è –µ–¥–∞ –¥–∞–µ—Ç –æ—á–∫–∏. –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.</p>
                    <button class="btn" onclick="buyItem('timedMode', 50)">–ö—É–ø–∏—Ç—å –∑–∞ 50 üí∞</button>
                </div>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–°–∫–∏–Ω—ã –∑–º–µ–π–∫–∏</h2>
                <div class="skin-navigation">
                    <button class="nav-btn" onclick="navigateShopSkin(-1)">‚Üê</button>
                    <div class="snake-preview" id="shopSnakePreview"></div>
                    <button class="nav-btn" onclick="navigateShopSkin(1)">‚Üí</button>
                </div>
                <div class="skin-info">
                    <h3 id="shopSkinName">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π</h3>
                    <p id="shopSkinDescription">–ó–µ–ª–µ–Ω–∞—è –∑–º–µ–π–∫–∞ —Å —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º</p>
                    <div class="shop-item-price" id="shopSkinPrice">0 üí∞</div>
                </div>
                <div class="shop-details" id="skinDetails">
                    <button class="btn" id="shopSkinBuyBtn" onclick="buyShopSkin()">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–§–æ–Ω—ã –∏–≥—Ä—ã</h2>
                <div class="skin-navigation">
                    <button class="nav-btn" onclick="navigateShopBackground(-1)">‚Üê</button>
                    <div class="skin-preview">
                        <div id="shopBackgroundDisplay" style="width: 100px; height: 60px; border-radius: 5px;"></div>
                    </div>
                    <button class="nav-btn" onclick="navigateShopBackground(1)">‚Üí</button>
                </div>
                <div class="skin-info">
                    <h3 id="shopBackgroundName">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</h3>
                    <p id="shopBackgroundDescription">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–∏–Ω–∏–π —Ñ–æ–Ω</p>
                    <div class="shop-item-price" id="shopBackgroundPrice">0 üí∞</div>
                </div>
                <div class="shop-details" id="backgroundDetails">
                    <button class="btn" id="shopBackgroundBuyBtn" onclick="buyShopBackground()">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            
            <button class="btn" onclick="showScreen('skinsScreen')">üêç –í—ã–±–æ—Ä —Å–∫–∏–Ω–∞</button>
            <button class="btn" onclick="showScreen('backgroundsScreen')">üé® –í—ã–±–æ—Ä —Ñ–æ–Ω–∞</button>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ñ–æ–Ω–æ–≤ -->
        <div id="backgroundsScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 class="title">–í—ã–±–æ—Ä —Ñ–æ–Ω–∞</h1>
            
            <div class="menu-section">
                <h2 class="section-title">–§–æ–Ω—ã –∏–≥—Ä—ã</h2>
                <div class="skin-navigation">
                    <button class="nav-btn" onclick="navigateBackground(-1)">‚Üê</button>
                    <div class="skin-preview">
                        <div id="backgroundDisplay" style="width: 100px; height: 60px; border-radius: 5px;"></div>
                    </div>
                    <button class="nav-btn" onclick="navigateBackground(1)">‚Üí</button>
                </div>
                <div class="skin-info">
                    <h3 id="backgroundName">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</h3>
                    <p id="backgroundDescription">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–∏–Ω–∏–π —Ñ–æ–Ω</p>
                </div>
                <button class="btn" onclick="applyBackground()" id="backgroundApplyBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω</button>
                <button class="btn" onclick="showScreen('shopScreen')">üõí –ú–∞–≥–∞–∑–∏–Ω —Ñ–æ–Ω–æ–≤</button>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
        <div id="profileScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 class="title">–ü—Ä–æ—Ñ–∏–ª—å</h1>
            
            <div class="menu-section">
                <h2 class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ</h2>
                <div class="profile-info">
                    <div class="profile-stat">
                        <span>–ù–∏–∫–Ω–µ–π–º:</span>
                        <span id="profileNickname">–ò–≥—Ä–æ–∫</span>
                    </div>
                    <div class="profile-stat">
                        <span>–ú–æ–Ω–µ—Ç—ã:</span>
                        <span id="profileCoins">0</span>
                    </div>
                    <div class="profile-stat">
                        <span>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç:</span>
                        <span id="profileMaxScore">0</span>
                    </div>
                    <div class="profile-stat">
                        <span>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞:</span>
                        <span id="profileMaxLength">0</span>
                    </div>
                </div>
                
                <div class="promocode-section">
                    <h2 class="section-title">–ü—Ä–æ–º–æ–∫–æ–¥—ã</h2>
                    <input type="text" class="promocode-input" id="promocodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
                    <button class="btn" onclick="activatePromocode()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
                </div>
                
                <div class="language-selector">
                    <h2 class="section-title">–Ø–∑—ã–∫ / Language</h2>
                    <div class="lang-btn lang-selected" onclick="changeLanguage('ru')">–†—É—Å—Å–∫–∏–π</div>
                    <div class="lang-btn" onclick="changeLanguage('en')">English</div>
                </div>
                
                <h2 class="section-title">–°–º–µ–Ω–∞ –Ω–∏–∫–Ω–µ–π–º–∞</h2>
                <input type="text" class="nickname-input" id="nicknameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º">
                <button class="btn" onclick="saveNickname()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∏–∫–Ω–µ–π–º</button>
            </div>
        </div>
        
        <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
        <div id="leaderboardScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 class="title">–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h1>
            
            <div class="menu-section">
                <h2 class="section-title">–õ—É—á—à–∏–µ –∏–≥—Ä–æ–∫–∏</h2>
                <div class="leaderboard" id="leaderboardList">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settingsScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 class="title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</h1>
            
            <div class="menu-section">
                <h2 class="section-title">–†–∞–∑–º–µ—Ä –ø–æ–ª—è</h2>
                <div class="field-size-option">
                    <div class="size-btn size-selected" onclick="selectFieldSize('small')">15√ó15</div>
                    <div class="size-btn" onclick="selectFieldSize('medium')">20√ó20</div>
                    <div class="size-btn" onclick="selectFieldSize('large')">25√ó25</div>
                </div>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–°–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä—ã</h2>
                <div class="slider-container">
                    <span>üê¢</span>
                    <input type="range" min="100" max="300" value="150" class="slider" id="speedSlider" onchange="updateSpeed()">
                    <span>üêÜ</span>
                    <div class="volume-value" id="speedValue">150</div>
                </div>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                <button class="btn" onclick="toggleControlType()" id="controlTypeBtn">üéÆ –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏</h2>
                <div class="slider-container">
                    <span>üîá</span>
                    <input type="range" min="0" max="100" value="50" class="slider" id="musicSlider" onchange="updateMusicVolume()">
                    <span>üîä</span>
                    <div class="volume-value" id="musicValue">50%</div>
                </div>
            </div>
            
            <div class="menu-section">
                <h2 class="section-title">–ì—Ä–æ–º–∫–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</h2>
                <div class="slider-container">
                    <span>üîá</span>
                    <input type="range" min="0" max="100" value="70" class="slider" id="soundSlider" onchange="updateSoundVolume()">
                    <span>üîä</span>
                    <div class="volume-value" id="soundValue">70%</div>
                </div>
            </div>
            
            <div class="menu-section">
                <button class="btn" onclick="toggleSound()" id="soundToggleBtn">üîä –í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫</button>
            </div>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="gameScreen" class="screen">
            <button class="back-btn" onclick="pauseGame()">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
            
            <div class="game-stats">
                <div class="stat-box">–°—á–µ—Ç: <span id="score">0</span></div>
                <div class="stat-box">–î–ª–∏–Ω–∞: <span id="snakeLength">1</span></div>
                <div class="stat-box" id="targetBox">–¶–µ–ª—å: <span id="targetScore">-</span></div>
                <div class="stat-box timer" id="timerBox" style="display: none;">–í—Ä–µ–º—è: <span id="timer">60</span></div>
            </div>
            
            <div class="game-container">
                <div class="canvas-container">
                    <canvas id="gameCanvas" width="400" height="400"></canvas>
                    
                    <div id="gameOver" class="game-over">
                        <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
                        <p>–í–∞—à —Å—á–µ—Ç: <span id="finalScore">0</span></p>
                        <p id="coinsEarnedText">+<span id="coinsEarned">0</span> üí∞</p>
                        <button class="menu-btn" onclick="resetGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                        <button class="menu-btn" onclick="showScreen('mainMenu')">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
                    </div>
                    
                    <div id="winScreen" class="win-screen">
                        <h2>–ü–æ–±–µ–¥–∞! üèÜ</h2>
                        <p>–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏!</p>
                        <p>+<span id="winCoinsEarned">0</span> üí∞</p>
                        <button class="menu-btn" onclick="resetGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                        <button class="menu-btn" onclick="showScreen('mainMenu')">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
                    </div>
                    
                    <div id="pauseScreen" class="pause-screen">
                        <h2>–ü–ê–£–ó–ê</h2>
                        <button class="menu-btn" onclick="resumeGame()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                        <button class="menu-btn" onclick="resetGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                        <button class="menu-btn" onclick="showScreen('mainMenu')">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
                <div class="mobile-controls" id="mobileControls">
                    <div class="controls">
                        <button id="up" class="control-btn">‚Üë</button>
                        <button id="left" class="control-btn">‚Üê</button>
                        <button id="right" class="control-btn">‚Üí</button>
                        <button id="down" class="control-btn">‚Üì</button>
                    </div>
                </div>
                
                <div class="keyboard-hint">
                    <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏, W,A,S,D –∏–ª–∏ –¶,–§,–´,–í –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –°–æ–∑–¥–∞–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω
        function createBackgroundAnimation() {
            const bg = document.getElementById('backgroundAnimation');
            bg.innerHTML = '';
            
            const particleCount = currentBackground === 'default' ? 15 : 30;
            let particleTypes = {
                'default': { colors: ['rgba(76, 201, 240, 0.3)', 'rgba(67, 97, 238, 0.3)'], emoji: '‚ú®' },
                'forest': { colors: ['#2E8B57', '#3CB371', '#8FBC8F'], emoji: 'üçÉ' },
                'desert': { colors: ['#D2B48C', '#F4A460', '#DEB887'], emoji: 'üèúÔ∏è' },
                'ocean': { colors: ['#1E90FF', '#00BFFF', '#87CEEB'], emoji: 'üåä' },
                'space': { colors: ['#4B0082', '#8A2BE2', '#9370DB'], emoji: '‚≠ê' },
                'potato': { colors: ['#8B4513', '#A0522D', '#CD853F'], emoji: 'ü•î' }
            };
            
            const particles = particleTypes[currentBackground] || particleTypes['default'];
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                if (currentBackground === 'default' || currentBackground === 'potato') {
                    particle.style.backgroundColor = particles.colors[Math.floor(Math.random() * particles.colors.length)];
                    particle.style.width = `${Math.random() * 20 + 5}px`;
                    particle.style.height = particle.style.width;
                } else {
                    particle.textContent = particles.emoji;
                    particle.style.fontSize = `${Math.random() * 20 + 10}px`;
                    particle.style.width = 'auto';
                    particle.style.height = 'auto';
                    particle.style.background = 'none';
                }
                
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDuration = `${Math.random() * 10 + 5}s`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                
                bg.appendChild(particle);
            }
        }

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const screens = document.querySelectorAll('.screen');
        const gameScreen = document.getElementById('gameScreen');
        const gameCanvas = document.getElementById('gameCanvas');
        const ctx = gameCanvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const snakeLengthElement = document.getElementById('snakeLength');
        const targetScoreElement = document.getElementById('targetScore');
        const targetBox = document.getElementById('targetBox');
        const timerBox = document.getElementById('timerBox');
        const timerElement = document.getElementById('timer');
        const gameOverScreen = document.getElementById('gameOver');
        const winScreen = document.getElementById('winScreen');
        const pauseScreen = document.getElementById('pauseScreen');
        const finalScoreElement = document.getElementById('finalScore');
        const coinsEarnedElement = document.getElementById('coinsEarned');
        const winCoinsEarnedElement = document.getElementById('winCoinsEarned');
        const coinsEarnedText = document.getElementById('coinsEarnedText');
        const coinCountElement = document.getElementById('coinCount');
        const shopCoinCountElement = document.getElementById('shopCoinCount');
        const nicknameDisplay = document.getElementById('nicknameDisplay');
        const profileNickname = document.getElementById('profileNickname');
        const profileCoins = document.getElementById('profileCoins');
        const profileMaxScore = document.getElementById('profileMaxScore');
        const profileMaxLength = document.getElementById('profileMaxLength');
        const nicknameInput = document.getElementById('nicknameInput');
        const leaderboardList = document.getElementById('leaderboardList');
        const mobileControls = document.getElementById('mobileControls');
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã
        let gridSize = 20;
        let gridWidth, gridHeight;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let snake = [];
        let foods = [];
        let direction = 'RIGHT';
        let score = 0;
        let gameSpeed = 150;
        let gameInterval;
        let timerInterval;
        let timeLeft = 60;
        let gameRunning = true;
        let gamePaused = false;
        let currentGameMode = 'endless';
        let targetScore = 10;
        let currentLevel = 1;
        let maxScore = 0;
        let maxLength = 0;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        let currentSkin = 'classic';
        let currentBackground = 'default';
        let fieldSize = 'medium';
        let controlType = 'buttons';
        let soundEnabled = true;
        let musicVolume = 50;
        let soundVolume = 70;
        let currentLanguage = 'ru';
        let playerNickname = '–ò–≥—Ä–æ–∫';
        
        // –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–µ—Ç –∏ –º–∞–≥–∞–∑–∏–Ω–∞
        let coins = 0;
        let purchasedItems = {
            timedMode: false,
            fireSkin: false,
            iceSkin: false,
            goldSkin: false,
            rainbowSkin: false,
            watermelonSkin: false,
            forestBg: false,
            desertBg: false,
            oceanBg: false,
            spaceBg: false,
            potatoBg: false
        };
        
        let usedPromocodes = [];
        let leaderboard = [];
        
        // –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫–∏–Ω—ã
        let availableSkins = [
            { 
                id: 'classic', 
                name: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', 
                description: '–ó–µ–ª–µ–Ω–∞—è –∑–º–µ–π–∫–∞ —Å —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º', 
                colors: { head: '#2E7D32', body: '#4CAF50' }, 
                pattern: 'simple',
                price: 0 
            },
            { 
                id: 'fire', 
                name: '–û–≥–Ω–µ–Ω–Ω—ã–π', 
                description: '–ì–æ—Ä—è—â–∞—è –∑–º–µ–π–∫–∞ —Å –ø–ª–∞–º–µ–Ω–Ω—ã–º —Ö–≤–æ—Å—Ç–æ–º', 
                colors: { head: '#FF5722', body: '#FF9800' }, 
                pattern: 'flame',
                price: 50 
            },
            { 
                id: 'ice', 
                name: '–õ–µ–¥—è–Ω–æ–π', 
                description: '–•–æ–ª–æ–¥–Ω–∞—è –∑–º–µ–π–∫–∞ —Å –ª–µ–¥—è–Ω—ã–º–∏ —á–µ—à—É–π–∫–∞–º–∏', 
                colors: { head: '#006978', body: '#00BCD4' }, 
                pattern: 'ice',
                price: 50 
            },
            { 
                id: 'gold', 
                name: '–ó–æ–ª–æ—Ç–æ–π', 
                description: '–†–æ—Å–∫–æ—à–Ω–∞—è –∑–æ–ª–æ—Ç–∞—è –∑–º–µ–π–∫–∞', 
                colors: { head: '#FFD700', body: '#FFA500' }, 
                pattern: 'shiny',
                price: 100 
            },
            { 
                id: 'rainbow', 
                name: '–†–∞–¥—É–∂–Ω—ã–π', 
                description: '–†–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω–∞—è —Ä–∞–¥—É–∂–Ω–∞—è –∑–º–µ–π–∫–∞', 
                colors: { head: '#FF0000', body: '#FFA500' }, 
                pattern: 'rainbow',
                price: 150 
            },
            { 
                id: 'zebra', 
                name: '–ó–µ–±—Ä–∞', 
                description: '–ß–µ—Ä–Ω–æ-–±–µ–ª–∞—è –ø–æ–ª–æ—Å–∞—Ç–∞—è –∑–º–µ–π–∫–∞', 
                colors: { head: '#000000', body: '#FFFFFF' }, 
                pattern: 'stripes',
                price: 80 
            },
            { 
                id: 'crystal', 
                name: '–ö—Ä–∏—Å—Ç–∞–ª—å–Ω—ã–π', 
                description: '–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –∫—Ä–∏—Å—Ç–∞–ª—å–Ω–∞—è –∑–º–µ–π–∫–∞', 
                colors: { head: '#E0FFFF', body: '#AFEEEE' }, 
                pattern: 'crystal',
                price: 120 
            },
            { 
                id: 'lava', 
                name: '–õ–∞–≤–æ–≤—ã–π', 
                description: '–†–∞—Å–∫–∞–ª–µ–Ω–Ω–∞—è –ª–∞–≤–æ–≤–∞—è –∑–º–µ–π–∫–∞', 
                colors: { head: '#FF4500', body: '#FF6347' }, 
                pattern: 'lava',
                price: 100 
            },
            { 
                id: 'jungle', 
                name: '–î–∂—É–Ω–≥–ª–∏', 
                description: '–ó–º–µ–π–∫–∞ —Å –∫–∞–º—É—Ñ–ª—è–∂–Ω—ã–º –æ–∫—Ä–∞—Å–æ–º', 
                colors: { head: '#228B22', body: '#32CD32' }, 
                pattern: 'camouflage',
                price: 90 
            },
            { 
                id: 'neon', 
                name: '–ù–µ–æ–Ω–æ–≤—ã–π', 
                description: '–°–≤–µ—Ç—è—â–∞—è—Å—è –Ω–µ–æ–Ω–æ–≤–∞—è –∑–º–µ–π–∫–∞', 
                colors: { head: '#00FF00', body: '#FF00FF' }, 
                pattern: 'neon',
                price: 200 
            },
            { 
                id: 'watermelon', 
                name: '–ê—Ä–±—É–∑–Ω—ã–π', 
                description: '–°–æ—á–Ω–∞—è –∞—Ä–±—É–∑–Ω–∞—è –∑–º–µ–π–∫–∞', 
                colors: { head: '#228B22', body: '#FF4500' }, 
                pattern: 'watermelon',
                price: 0,
                secret: true
            }
        ];
        
        let currentSkinIndex = 0;
        let currentShopSkinIndex = 0;
        
        // –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ–Ω—ã
        let availableBackgrounds = [
            { id: 'default', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π', description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–∏–Ω–∏–π —Ñ–æ–Ω —Å —á–∞—Å—Ç–∏—Ü–∞–º–∏', price: 0 },
            { id: 'forest', name: '–õ–µ—Å–Ω–æ–π', description: '–ó–µ–ª–µ–Ω—ã–π –ª–µ—Å–Ω–æ–π —Ñ–æ–Ω —Å –ª–∏—Å—Ç—å—è–º–∏', price: 80 },
            { id: 'desert', name: '–ü—É—Å—Ç—ã–Ω–Ω—ã–π', description: '–ü–µ—Å—á–∞–Ω—ã–π –ø—É—Å—Ç—ã–Ω–Ω—ã–π —Ñ–æ–Ω —Å –ø–µ—Å—á–∏–Ω–∫–∞–º–∏', price: 80 },
            { id: 'ocean', name: '–û–∫–µ–∞–Ω', description: '–ì–æ–ª—É–±–æ–π –æ–∫–µ–∞–Ω—Å–∫–∏–π —Ñ–æ–Ω —Å –≤–æ–ª–Ω–∞–º–∏', price: 100 },
            { id: 'space', name: '–ö–æ—Å–º–æ—Å', description: '–¢–µ–º–Ω—ã–π –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω —Å–æ –∑–≤–µ–∑–¥–∞–º–∏', price: 120 },
            { id: 'potato', name: '–ö–∞—Ä—Ç–æ—à–∫–∞', description: '–°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ñ–æ–Ω —Å –ø–∞–¥–∞—é—â–µ–π –∫–∞—Ä—Ç–æ—à–∫–æ–π', price: 0, secret: true }
        ];
        
        let currentBackgroundIndex = 0;
        let currentShopBackgroundIndex = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initGame() {
            updateFieldSize();
            loadGameData();
            updateSkinDisplay();
            updateShopSkinDisplay();
            updateBackgroundDisplay();
            updateShopBackgroundDisplay();
            createBackgroundAnimation();
            updateLeaderboard();
            updateProfile();
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            if (isMobile) {
                controlType = 'swipe';
                document.getElementById('controlTypeBtn').textContent = '‚ÜîÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞–º–∏';
                mobileControls.style.display = 'grid';
            } else {
                controlType = 'buttons';
                document.getElementById('controlTypeBtn').textContent = 'üéÆ –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è';
                mobileControls.style.display = 'none';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('up').addEventListener('touchstart', (e) => {
                e.preventDefault();
                changeDirection('UP');
            });
            
            document.getElementById('down').addEventListener('touchstart', (e) => {
                e.preventDefault();
                changeDirection('DOWN');
            });
            
            document.getElementById('left').addEventListener('touchstart', (e) => {
                e.preventDefault();
                changeDirection('LEFT');
            });
            
            document.getElementById('right').addEventListener('touchstart', (e) => {
                e.preventDefault();
                changeDirection('RIGHT');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–ª–∞–≤–∏—à WASD –∏ –¶–§–´–í
            document.addEventListener('keydown', (event) => {
                switch(event.key.toLowerCase()) {
                    case 'w': 
                    case '—Ü': 
                        changeDirection('UP'); 
                        break;
                    case 's': 
                    case '—ã': 
                        changeDirection('DOWN'); 
                        break;
                    case 'a': 
                    case '—Ñ': 
                        changeDirection('LEFT'); 
                        break;
                    case 'd': 
                    case '–≤': 
                        changeDirection('RIGHT'); 
                        break;
                    case 'arrowup': changeDirection('UP'); break;
                    case 'arrowdown': changeDirection('DOWN'); break;
                    case 'arrowleft': changeDirection('LEFT'); break;
                    case 'arrowright': changeDirection('RIGHT'); break;
                    case 'escape': pauseGame(); break;
                }
            });
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞–º–∏
        function showScreen(screenId) {
            screens.forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'flex';
            
            if (screenId === 'gameScreen') {
                resetGame();
            }
            
            if (screenId === 'profileScreen') {
                updateProfile();
            }
            
            if (screenId === 'shopScreen') {
                updateShopCoinDisplay();
            }
        }
        
        function startGame(mode) {
            currentGameMode = mode;
            
            if (mode === 'target') {
                targetBox.style.display = 'flex';
                timerBox.style.display = 'none';
                targetScoreElement.textContent = targetScore;
            } else if (mode === 'timed') {
                targetBox.style.display = 'none';
                timerBox.style.display = 'flex';
                timeLeft = 60;
                timerElement.textContent = timeLeft;
            } else {
                targetBox.style.display = 'none';
                timerBox.style.display = 'none';
            }
            
            showScreen('gameScreen');
        }
        
        function pauseGame() {
            if (gameRunning && !gamePaused) {
                gamePaused = true;
                pauseScreen.style.display = 'flex';
                
                if (currentGameMode === 'timed') {
                    clearInterval(timerInterval);
                }
            }
        }
        
        function resumeGame() {
            if (gamePaused) {
                gamePaused = false;
                pauseScreen.style.display = 'none';
                
                if (currentGameMode === 'timed') {
                    startTimer();
                }
            }
        }
        
        // –¢–∞–π–º–µ—Ä –¥–ª—è —Ä–µ–∂–∏–º–∞ –Ω–∞ –≤—Ä–µ–º—è
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                if (!gamePaused && gameRunning) {
                    timeLeft--;
                    timerElement.textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        endTimedGame();
                    }
                }
            }, 1000);
        }
        
        function endTimedGame() {
            gameRunning = false;
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –º–æ–Ω–µ—Ç—ã –∑–∞ –æ—á–∫–∏ –≤ —Ä–µ–∂–∏–º–µ –Ω–∞ –≤—Ä–µ–º—è
            const coinsEarned = Math.floor(score / 5);
            addCoins(coinsEarned);
            
            finalScoreElement.textContent = score;
            coinsEarnedElement.textContent = coinsEarned;
            coinsEarnedText.style.display = 'block';
            gameOverScreen.style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
            updateLeaderboard();
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–∫–∏–Ω–∞–º
        function navigateSkin(direction) {
            currentSkinIndex += direction;
            if (currentSkinIndex < 0) currentSkinIndex = availableSkins.length - 1;
            if (currentSkinIndex >= availableSkins.length) currentSkinIndex = 0;
            updateSkinDisplay();
        }
        
        function updateSkinDisplay() {
            const skin = availableSkins[currentSkinIndex];
            document.getElementById('skinName').textContent = skin.name;
            document.getElementById('skinDescription').textContent = skin.description;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–º–µ–π–∫—É —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Å–∫–∏–Ω–æ–º
            const snakePreview = document.getElementById('snakePreview');
            snakePreview.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –≥–æ–ª–æ–≤—É –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Ç–µ–ª–∞
            const head = document.createElement('div');
            head.className = 'snake-segment snake-head';
            head.style.background = skin.colors.head;
            head.style.left = '50%';
            head.style.transform = 'translateX(-50%)';
            snakePreview.appendChild(head);
            
            // –°–æ–∑–¥–∞–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã —Ç–µ–ª–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —É–∑–æ—Ä–æ–º
            for (let i = 1; i <= 4; i++) {
                const segment = document.createElement('div');
                segment.className = 'snake-segment';
                
                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã
                segment.style.left = `calc(50% - ${i * 22}px)`;
                segment.style.transform = 'translateX(-50%)';
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–∑–æ—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–∫–∏–Ω–∞
                applySkinPattern(segment, skin, i);
                
                snakePreview.appendChild(segment);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
            const applyBtn = document.getElementById('skinApplyBtn');
            if (skin.price === 0 || purchasedItems[skin.id + 'Skin'] || skin.secret) {
                applyBtn.disabled = false;
                applyBtn.textContent = currentLanguage === 'ru' ? '–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–∫–∏–Ω' : 'Apply Skin';
            } else {
                applyBtn.disabled = true;
                applyBtn.textContent = currentLanguage === 'ru' ? '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ' : 'Not Available';
            }
        }
        
        function applySkinPattern(segment, skin, index) {
            segment.style.background = skin.colors.body;
            
            switch(skin.pattern) {
                case 'flame':
                    segment.style.background = `linear-gradient(45deg, ${skin.colors.head}, ${skin.colors.body})`;
                    segment.style.boxShadow = '0 0 5px #FF4500';
                    break;
                case 'ice':
                    segment.style.background = `linear-gradient(45deg, ${skin.colors.head}, ${skin.colors.body}, #E0FFFF)`;
                    segment.style.boxShadow = '0 0 5px #00BFFF';
                    break;
                case 'shiny':
                    segment.style.background = `radial-gradient(circle, ${skin.colors.head}, ${skin.colors.body})`;
                    segment.style.boxShadow = '0 0 8px gold';
                    break;
                case 'rainbow':
                    const rainbowColors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#8B00FF'];
                    segment.style.background = rainbowColors[index % rainbowColors.length];
                    break;
                case 'stripes':
                    segment.style.background = `repeating-linear-gradient(45deg, ${skin.colors.head}, ${skin.colors.head} 5px, ${skin.colors.body} 5px, ${skin.colors.body} 10px)`;
                    break;
                case 'crystal':
                    segment.style.background = `linear-gradient(135deg, ${skin.colors.head} 20%, ${skin.colors.body} 50%, #FFFFFF 80%)`;
                    segment.style.opacity = '0.8';
                    break;
                case 'lava':
                    segment.style.background = `linear-gradient(45deg, #FF0000, ${skin.colors.head}, ${skin.colors.body})`;
                    segment.style.boxShadow = '0 0 10px #FF4500';
                    break;
                case 'camouflage':
                    segment.style.background = `radial-gradient(circle, ${skin.colors.head} 20%, ${skin.colors.body} 40%, #8B4513 60%)`;
                    break;
                case 'neon':
                    segment.style.background = skin.colors.body;
                    segment.style.boxShadow = `0 0 10px ${skin.colors.head}, 0 0 20px ${skin.colors.body}`;
                    break;
                case 'watermelon':
                    segment.style.background = `radial-gradient(circle, #228B22 30%, #FF4500 70%)`;
                    segment.style.boxShadow = '0 0 5px #228B22';
                    break;
                default:
                    // –ü—Ä–æ—Å—Ç–æ–π —É–∑–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    segment.style.background = skin.colors.body;
            }
        }
        
        function applySkin() {
            const skin = availableSkins[currentSkinIndex];
            if (skin.price === 0 || purchasedItems[skin.id + 'Skin'] || skin.secret) {
                currentSkin = skin.id;
                alert(currentLanguage === 'ru' ? `–°–∫–∏–Ω "${skin.name}" –ø—Ä–∏–º–µ–Ω–µ–Ω!` : `Skin "${skin.name}" applied!`);
                resetGame();
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–∫–∏–Ω–∞–º –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        function navigateShopSkin(direction) {
            currentShopSkinIndex += direction;
            if (currentShopSkinIndex < 0) currentShopSkinIndex = availableSkins.length - 1;
            if (currentShopSkinIndex >= availableSkins.length) currentShopSkinIndex = 0;
            updateShopSkinDisplay();
        }
        
        function updateShopSkinDisplay() {
            const skin = availableSkins[currentShopSkinIndex];
            document.getElementById('shopSkinName').textContent = skin.name;
            document.getElementById('shopSkinDescription').textContent = skin.description;
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ü–µ–Ω—É –¥–ª—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤
            if (skin.secret) {
                document.getElementById('shopSkinPrice').textContent = '–°–µ–∫—Ä–µ—Ç–Ω—ã–π';
            } else {
                document.getElementById('shopSkinPrice').textContent = skin.price + ' üí∞';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–º–µ–π–∫—É —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Å–∫–∏–Ω–æ–º
            const snakePreview = document.getElementById('shopSnakePreview');
            snakePreview.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –≥–æ–ª–æ–≤—É –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Ç–µ–ª–∞
            const head = document.createElement('div');
            head.className = 'snake-segment snake-head';
            head.style.background = skin.colors.head;
            head.style.left = '50%';
            head.style.transform = 'translateX(-50%)';
            snakePreview.appendChild(head);
            
            // –°–æ–∑–¥–∞–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã —Ç–µ–ª–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —É–∑–æ—Ä–æ–º
            for (let i = 1; i <= 4; i++) {
                const segment = document.createElement('div');
                segment.className = 'snake-segment';
                
                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã
                segment.style.left = `calc(50% - ${i * 22}px)`;
                segment.style.transform = 'translateX(-50%)';
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–∑–æ—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–∫–∏–Ω–∞
                applySkinPattern(segment, skin, i);
                
                snakePreview.appendChild(segment);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
            const buyBtn = document.getElementById('shopSkinBuyBtn');
            if (skin.secret) {
                buyBtn.textContent = '–°–µ–∫—Ä–µ—Ç–Ω—ã–π —Å–∫–∏–Ω';
                buyBtn.disabled = true;
            } else if (purchasedItems[skin.id + 'Skin']) {
                buyBtn.textContent = currentLanguage === 'ru' ? '–£–∂–µ –∫—É–ø–ª–µ–Ω–æ' : 'Already Purchased';
                buyBtn.disabled = true;
            } else {
                buyBtn.textContent = currentLanguage === 'ru' ? `–ö—É–ø–∏—Ç—å –∑–∞ ${skin.price} üí∞` : `Buy for ${skin.price} üí∞`;
                buyBtn.disabled = coins < skin.price;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
            document.getElementById('skinDetails').style.display = 'block';
        }
        
        function buyShopSkin() {
            const skin = availableSkins[currentShopSkinIndex];
            if (coins >= skin.price && !purchasedItems[skin.id + 'Skin'] && !skin.secret) {
                coins -= skin.price;
                purchasedItems[skin.id + 'Skin'] = true;
                updateCoinDisplay();
                updateShopSkinDisplay();
                saveGameData();
                alert(currentLanguage === 'ru' ? `–°–∫–∏–Ω "${skin.name}" –∫—É–ø–ª–µ–Ω!` : `Skin "${skin.name}" purchased!`);
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ñ–æ–Ω–∞–º
        function navigateBackground(direction) {
            currentBackgroundIndex += direction;
            if (currentBackgroundIndex < 0) currentBackgroundIndex = availableBackgrounds.length - 1;
            if (currentBackgroundIndex >= availableBackgrounds.length) currentBackgroundIndex = 0;
            updateBackgroundDisplay();
        }
        
        function updateBackgroundDisplay() {
            const bg = availableBackgrounds[currentBackgroundIndex];
            document.getElementById('backgroundName').textContent = bg.name;
            document.getElementById('backgroundDescription').textContent = bg.description;
            
            const bgDisplay = document.getElementById('backgroundDisplay');
            applyBackgroundToElement(bgDisplay, bg.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
            const applyBtn = document.getElementById('backgroundApplyBtn');
            if (bg.price === 0 || purchasedItems[bg.id + 'Bg'] || bg.secret) {
                applyBtn.disabled = false;
                applyBtn.textContent = currentLanguage === 'ru' ? '–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω' : 'Apply Background';
            } else {
                applyBtn.disabled = true;
                applyBtn.textContent = currentLanguage === 'ru' ? '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ' : 'Not Available';
            }
        }
        
        function applyBackground() {
            const bg = availableBackgrounds[currentBackgroundIndex];
            if (bg.price === 0 || purchasedItems[bg.id + 'Bg'] || bg.secret) {
                currentBackground = bg.id;
                applyBackgroundVisual();
                createBackgroundAnimation();
                alert(currentLanguage === 'ru' ? `–§–æ–Ω "${bg.name}" –ø—Ä–∏–º–µ–Ω–µ–Ω!` : `Background "${bg.name}" applied!`);
                saveGameData();
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ñ–æ–Ω–∞–º –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        function navigateShopBackground(direction) {
            currentShopBackgroundIndex += direction;
            if (currentShopBackgroundIndex < 0) currentShopBackgroundIndex = availableBackgrounds.length - 1;
            if (currentShopBackgroundIndex >= availableBackgrounds.length) currentShopBackgroundIndex = 0;
            updateShopBackgroundDisplay();
        }
        
        function updateShopBackgroundDisplay() {
            const bg = availableBackgrounds[currentShopBackgroundIndex];
            document.getElementById('shopBackgroundName').textContent = bg.name;
            document.getElementById('shopBackgroundDescription').textContent = bg.description;
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ü–µ–Ω—É –¥–ª—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–æ–Ω–æ–≤
            if (bg.secret) {
                document.getElementById('shopBackgroundPrice').textContent = '–°–µ–∫—Ä–µ—Ç–Ω—ã–π';
            } else {
                document.getElementById('shopBackgroundPrice').textContent = bg.price + ' üí∞';
            }
            
            const bgDisplay = document.getElementById('shopBackgroundDisplay');
            applyBackgroundToElement(bgDisplay, bg.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
            const buyBtn = document.getElementById('shopBackgroundBuyBtn');
            if (bg.secret) {
                buyBtn.textContent = '–°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ñ–æ–Ω';
                buyBtn.disabled = true;
            } else if (purchasedItems[bg.id + 'Bg']) {
                buyBtn.textContent = currentLanguage === 'ru' ? '–£–∂–µ –∫—É–ø–ª–µ–Ω–æ' : 'Already Purchased';
                buyBtn.disabled = true;
            } else {
                buyBtn.textContent = currentLanguage === 'ru' ? `–ö—É–ø–∏—Ç—å –∑–∞ ${bg.price} üí∞` : `Buy for ${bg.price} üí∞`;
                buyBtn.disabled = coins < bg.price;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
            document.getElementById('backgroundDetails').style.display = 'block';
        }
        
        function buyShopBackground() {
            const bg = availableBackgrounds[currentShopBackgroundIndex];
            if (coins >= bg.price && !purchasedItems[bg.id + 'Bg'] && !bg.secret) {
                coins -= bg.price;
                purchasedItems[bg.id + 'Bg'] = true;
                updateCoinDisplay();
                updateShopBackgroundDisplay();
                saveGameData();
                alert(currentLanguage === 'ru' ? `–§–æ–Ω "${bg.name}" –∫—É–ø–ª–µ–Ω!` : `Background "${bg.name}" purchased!`);
            }
        }
        
        function applyBackgroundToElement(element, bgId) {
            switch(bgId) {
                case 'default': 
                    element.style.background = 'linear-gradient(135deg, #1a1a2e, #16213e, #0f3460)';
                    break;
                case 'forest': 
                    element.style.background = 'linear-gradient(135deg, #1B5E20, #2E7D32, #388E3C)';
                    break;
                case 'desert': 
                    element.style.background = 'linear-gradient(135deg, #BF360C, #E65100, #FF6D00)';
                    break;
                case 'ocean': 
                    element.style.background = 'linear-gradient(135deg, #1E90FF, #00BFFF, #87CEEB)';
                    break;
                case 'space': 
                    element.style.background = 'linear-gradient(135deg, #0f0c29, #302b63, #24243e)';
                    break;
                case 'potato': 
                    element.style.background = 'linear-gradient(135deg, #8B4513, #A0522D, #CD853F)';
                    break;
            }
        }
        
        // –°–∏—Å—Ç–µ–º–∞ –º–∞–≥–∞–∑–∏–Ω–∞
        function showShopDetails(item) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏
            document.querySelectorAll('.shop-details').forEach(detail => {
                detail.style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
            document.getElementById(item + 'Details').style.display = 'block';
        }
        
        function buyItem(item, price) {
            if (coins >= price && !purchasedItems[item]) {
                coins -= price;
                purchasedItems[item] = true;
                updateCoinDisplay();
                saveGameData();
                alert(currentLanguage === 'ru' ? '–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞!' : 'Purchase successful!');
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                if (item === 'timedMode') {
                    document.getElementById('timedModeBtn').disabled = false;
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
                document.getElementById(item + 'Details').style.display = 'none';
            } else if (purchasedItems[item]) {
                alert(currentLanguage === 'ru' ? '–≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –∫—É–ø–ª–µ–Ω!' : 'This item is already purchased!');
            } else {
                alert(currentLanguage === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!' : 'Not enough coins!');
            }
        }
        
        // –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–µ—Ç
        function addCoins(amount) {
            coins += amount;
            updateCoinDisplay();
            saveGameData();
        }
        
        function updateCoinDisplay() {
            coinCountElement.textContent = coins;
        }
        
        function updateShopCoinDisplay() {
            shopCoinCountElement.textContent = coins;
        }
        
        // –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
        function activatePromocode() {
            const promocodeInput = document.getElementById('promocodeInput');
            const promocode = promocodeInput.value.trim().toUpperCase();
            
            if (usedPromocodes.includes(promocode)) {
                alert(currentLanguage === 'ru' ? '–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!' : 'This promocode has already been used!');
                return;
            }
            
            switch(promocode) {
                case 'POTATO':
                    purchasedItems.potatoBg = true;
                    usedPromocodes.push(promocode);
                    alert(currentLanguage === 'ru' ? '–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –û—Ç–∫—Ä—ã—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ñ–æ–Ω "–ö–∞—Ä—Ç–æ—à–∫–∞"' : 'Promocode activated! Secret background "Potato" unlocked');
                    promocodeInput.value = '';
                    saveGameData();
                    break;
                case 'DEEPSEEK':
                    addCoins(200);
                    usedPromocodes.push(promocode);
                    alert(currentLanguage === 'ru' ? '–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +200 –º–æ–Ω–µ—Ç' : 'Promocode activated! +200 coins');
                    promocodeInput.value = '';
                    saveGameData();
                    break;
                case 'MELON':
                    purchasedItems.watermelonSkin = true;
                    usedPromocodes.push(promocode);
                    alert(currentLanguage === 'ru' ? '–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –û—Ç–∫—Ä—ã—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Å–∫–∏–Ω "–ê—Ä–±—É–∑–Ω—ã–π"' : 'Promocode activated! Secret skin "Watermelon" unlocked');
                    promocodeInput.value = '';
                    saveGameData();
                    break;
                default:
                    alert(currentLanguage === 'ru' ? '–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥!' : 'Invalid promocode!');
            }
        }
        
        // –°–∏—Å—Ç–µ–º–∞ –Ω–∏–∫–Ω–µ–π–º–∞
        function saveNickname() {
            const newNickname = nicknameInput.value.trim();
            if (newNickname) {
                playerNickname = newNickname;
                nicknameDisplay.textContent = playerNickname;
                saveGameData();
                alert(currentLanguage === 'ru' ? '–ù–∏–∫–Ω–µ–π–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω!' : 'Nickname saved!');
            } else {
                alert(currentLanguage === 'ru' ? '–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º!' : 'Enter a nickname!');
            }
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞
        function applyBackgroundVisual() {
            const body = document.body;
            switch(currentBackground) {
                case 'default':
                    body.style.background = 'linear-gradient(135deg, #1a1a2e, #16213e, #0f3460)';
                    break;
                case 'forest':
                    body.style.background = 'linear-gradient(135deg, #1B5E20, #2E7D32, #388E3C)';
                    break;
                case 'desert':
                    body.style.background = 'linear-gradient(135deg, #BF360C, #E65100, #FF6D00)';
                    break;
                case 'ocean':
                    body.style.background = 'linear-gradient(135deg, #1E90FF, #00BFFF, #87CEEB)';
                    break;
                case 'space':
                    body.style.background = 'linear-gradient(135deg, #0f0c29, #302b63, #24243e)';
                    break;
                case 'potato':
                    body.style.background = 'linear-gradient(135deg, #8B4513, #A0522D, #CD853F)';
                    break;
            }
        }
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞
        function changeLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('lang-selected');
            });
            event.target.classList.add('lang-selected');
            saveGameData();
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–≤–æ–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            alert(lang === 'ru' ? '–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ —Ä—É—Å—Å–∫–∏–π' : 'Language changed to English');
        }
        
        // –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
        function updateLeaderboard() {
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤, –µ—Å–ª–∏ –µ–≥–æ —Å—á–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã—Å–æ–∫
            if (score > 0) {
                const existingIndex = leaderboard.findIndex(entry => entry.name === playerNickname);
                
                if (existingIndex !== -1) {
                    if (score > leaderboard[existingIndex].score) {
                        leaderboard[existingIndex].score = score;
                    }
                } else {
                    leaderboard.push({ name: playerNickname, score: score });
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—á–µ—Ç–∞
                leaderboard.sort((a, b) => b.score - a.score);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤ 10 –ª—É—á—à–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏
                leaderboard = leaderboard.slice(0, 10);
                
                saveGameData();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
            leaderboardList.innerHTML = '';
            
            if (leaderboard.length === 0) {
                leaderboardList.innerHTML = '<p style="text-align: center; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤</p>';
                return;
            }
            
            leaderboard.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                
                item.innerHTML = `
                    <div class="leaderboard-position">${index + 1}</div>
                    <div class="leaderboard-name">${entry.name}</div>
                    <div class="leaderboard-score">${entry.score}</div>
                `;
                
                leaderboardList.appendChild(item);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfile() {
            profileNickname.textContent = playerNickname;
            profileCoins.textContent = coins;
            profileMaxScore.textContent = maxScore;
            profileMaxLength.textContent = maxLength;
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—è
        function selectFieldSize(size) {
            document.querySelectorAll('.size-btn').forEach(el => {
                el.classList.remove('size-selected');
            });
            event.target.classList.add('size-selected');
            fieldSize = size;
            updateFieldSize();
        }
        
        function updateFieldSize() {
            switch(fieldSize) {
                case 'small':
                    gridSize = 25;
                    gameCanvas.width = 375;
                    gameCanvas.height = 375;
                    break;
                case 'medium':
                    gridSize = 20;
                    gameCanvas.width = 400;
                    gameCanvas.height = 400;
                    break;
                case 'large':
                    gridSize = 16;
                    gameCanvas.width = 400;
                    gameCanvas.height = 400;
                    break;
            }
            gridWidth = gameCanvas.width / gridSize;
            gridHeight = gameCanvas.height / gridSize;
            resetGame();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏
        function updateSpeed() {
            const slider = document.getElementById('speedSlider');
            const value = document.getElementById('speedValue');
            gameSpeed = 400 - slider.value;
            value.textContent = slider.value;
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = setInterval(gameLoop, gameSpeed);
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞
        function updateMusicVolume() {
            const slider = document.getElementById('musicSlider');
            const value = document.getElementById('musicValue');
            musicVolume = slider.value;
            value.textContent = musicVolume + '%';
        }
        
        function updateSoundVolume() {
            const slider = document.getElementById('soundSlider');
            const value = document.getElementById('soundValue');
            soundVolume = slider.value;
            value.textContent = soundVolume + '%';
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundToggleBtn');
            btn.textContent = soundEnabled ? 'üîä –í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫' : 'üîá –í—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫';
        }
        
        function toggleControlType() {
            controlType = controlType === 'buttons' ? 'swipe' : 'buttons';
            const btn = document.getElementById('controlTypeBtn');
            const controls = document.getElementById('controlsContainer');
            const mobileControls = document.getElementById('mobileControls');
            
            if (controlType === 'buttons') {
                btn.textContent = 'üéÆ –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è';
                controls.style.display = 'grid';
                mobileControls.style.display = 'grid';
            } else {
                btn.textContent = '‚ÜîÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞–º–∏';
                controls.style.display = 'none';
                mobileControls.style.display = 'none';
            }
        }
        
        // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç—É—Ä—ã
        function createTextures() {
            const skin = availableSkins.find(s => s.id === currentSkin) || availableSkins[0];
            const skinColors = skin.colors;
            
            const headTexture = document.createElement('canvas');
            headTexture.width = gridSize;
            headTexture.height = gridSize;
            const headCtx = headTexture.getContext('2d');
            
            // –†–∏—Å—É–µ–º –≥–æ–ª–æ–≤—É –∑–º–µ–π–∫–∏ —Å —É—á–µ—Ç–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            headCtx.fillStyle = skinColors.head;
            headCtx.fillRect(0, 0, gridSize, gridSize);
            
            // –†–∏—Å—É–µ–º –≥–ª–∞–∑–∞
            headCtx.fillStyle = '#FFFFFF';
            headCtx.fillRect(5, 5, 4, 4);
            headCtx.fillRect(11, 5, 4, 4);
            headCtx.fillStyle = '#000000';
            headCtx.fillRect(6, 6, 2, 2);
            headCtx.fillRect(12, 6, 2, 2);
            
            // –†–∏—Å—É–µ–º —Ä–æ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            headCtx.fillStyle = '#FF5252';
            if (direction === 'RIGHT') {
                headCtx.fillRect(gridSize - 4, gridSize/2 - 2, 4, 4);
            } else if (direction === 'LEFT') {
                headCtx.fillRect(0, gridSize/2 - 2, 4, 4);
            } else if (direction === 'UP') {
                headCtx.fillRect(gridSize/2 - 2, 0, 4, 4);
            } else if (direction === 'DOWN') {
                headCtx.fillRect(gridSize/2 - 2, gridSize - 4, 4, 4);
            }
            
            const bodyTexture = document.createElement('canvas');
            bodyTexture.width = gridSize;
            bodyTexture.height = gridSize;
            const bodyCtx = bodyTexture.getContext('2d');
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —É–∑–æ—Ä –¥–ª—è —Ç–µ–ª–∞ –∑–º–µ–π–∫–∏
            applyBodyPattern(bodyCtx, skin, gridSize);
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤ –µ–¥—ã
            const appleTexture = createFoodTexture('üçé', '#FF5252');
            const orangeTexture = createFoodTexture('üçä', '#FF9800');
            const pearTexture = createFoodTexture('üçê', '#8BC34A');
            const potatoTexture = createFoodTexture('ü•î', '#8D6E63');
            const coinTexture = createFoodTexture('üí∞', '#FFD700');
            
            return {
                background: createBackgroundTexture(),
                snakeBody: bodyTexture,
                snakeHead: headTexture,
                apple: appleTexture,
                orange: orangeTexture,
                pear: pearTexture,
                potato: potatoTexture,
                coin: coinTexture
            };
        }
        
        function applyBodyPattern(ctx, skin, size) {
            ctx.fillStyle = skin.colors.body;
            ctx.fillRect(0, 0, size, size);
            
            switch(skin.pattern) {
                case 'flame':
                    // –ü–ª–∞–º–µ–Ω–Ω—ã–π —É–∑–æ—Ä
                    ctx.fillStyle = '#FF4500';
                    for (let i = 0; i < 3; i++) {
                        for (let j = 0; j < 3; j++) {
                            if ((i + j) % 2 === 0) {
                                ctx.fillRect(i * 6 + 2, j * 6 + 2, 4, 4);
                            }
                        }
                    }
                    break;
                case 'ice':
                    // –õ–µ–¥—è–Ω–æ–π —É–∑–æ—Ä
                    ctx.fillStyle = '#E0FFFF';
                    for (let i = 0; i < 4; i++) {
                        ctx.beginPath();
                        ctx.arc(4 + i * 5, 4 + i * 4, 2, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    break;
                case 'shiny':
                    // –ë–ª–µ—Å—Ç—è—â–∏–π —É–∑–æ—Ä
                    ctx.fillStyle = '#FFFFFF';
                    ctx.globalAlpha = 0.7;
                    ctx.fillRect(4, 4, 4, 4);
                    ctx.fillRect(12, 12, 4, 4);
                    ctx.globalAlpha = 1.0;
                    break;
                case 'rainbow':
                    // –†–∞–¥—É–∂–Ω—ã–π —É–∑–æ—Ä - –∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç –±—É–¥–µ—Ç —Ä–∞–∑–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
                    // –≠—Ç–æ—Ç —É–∑–æ—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
                    // –î–ª—è —Ä–∞–¥—É–∂–Ω–æ–π –∑–º–µ–π–∫–∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º —É–∑–æ—Ä –Ω–∞ —Ç–µ–∫—Å—Ç—É—Ä—É —Ç–µ–ª–∞
                    break;
                case 'stripes':
                    // –ü–æ–ª–æ—Å–∞—Ç—ã–π —É–∑–æ—Ä
                    ctx.fillStyle = skin.colors.head;
                    for (let i = 0; i < size; i += 4) {
                        ctx.fillRect(0, i, size, 2);
                    }
                    break;
                case 'crystal':
                    // –ö—Ä–∏—Å—Ç–∞–ª—å–Ω—ã–π —É–∑–æ—Ä
                    ctx.fillStyle = '#FFFFFF';
                    ctx.globalAlpha = 0.5;
                    for (let i = 0; i < 3; i++) {
                        ctx.beginPath();
                        ctx.moveTo(4 + i * 6, 4);
                        ctx.lineTo(8 + i * 6, 8);
                        ctx.lineTo(4 + i * 6, 12);
                        ctx.closePath();
                        ctx.fill();
                    }
                    ctx.globalAlpha = 1.0;
                    break;
                case 'lava':
                    // –õ–∞–≤–æ–≤—ã–π —É–∑–æ—Ä
                    ctx.fillStyle = '#FF0000';
                    for (let i = 0; i < 4; i++) {
                        ctx.beginPath();
                        ctx.arc(4 + i * 4, 4 + i * 3, 2, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    break;
                case 'camouflage':
                    // –ö–∞–º—É—Ñ–ª—è–∂–Ω—ã–π —É–∑–æ—Ä
                    ctx.fillStyle = '#8B4513';
                    ctx.fillRect(2, 2, 8, 8);
                    ctx.fillRect(10, 10, 6, 6);
                    break;
                case 'neon':
                    // –ù–µ–æ–Ω–æ–≤—ã–π —É–∑–æ—Ä
                    ctx.fillStyle = skin.colors.head;
                    ctx.fillRect(2, 2, 4, 4);
                    ctx.fillRect(10, 10, 4, 4);
                    ctx.fillRect(6, 14, 4, 2);
                    break;
                case 'watermelon':
                    // –ê—Ä–±—É–∑–Ω—ã–π —É–∑–æ—Ä
                    ctx.fillStyle = '#000000';
                    for (let i = 0; i < 3; i++) {
                        for (let j = 0; j < 3; j++) {
                            if ((i + j) % 2 === 0) {
                                ctx.fillRect(i * 6 + 2, j * 6 + 2, 2, 2);
                            }
                        }
                    }
                    break;
                default:
                    // –ü—Ä–æ—Å—Ç–æ–π —É–∑–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    ctx.fillStyle = skin.colors.head;
                    for (let i = 0; i < 3; i++) {
                        for (let j = 0; j < 3; j++) {
                            if ((i + j) % 2 === 0) {
                                ctx.fillRect(i * 6 + 2, j * 6 + 2, 4, 4);
                            }
                        }
                    }
            }
        }
        
        function createFoodTexture(emoji, color) {
            const texture = document.createElement('canvas');
            texture.width = gridSize;
            texture.height = gridSize;
            const ctx = texture.getContext('2d');
            
            // –†–∏—Å—É–µ–º –∫—Ä—É–≥–ª—É—é –æ—Å–Ω–æ–≤—É
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(gridSize/2, gridSize/2, gridSize/2 - 2, 0, Math.PI * 2);
            ctx.fill();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            ctx.font = `${gridSize * 0.6}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, gridSize/2, gridSize/2);
            
            return texture;
        }
        
        function createBackgroundTexture() {
            const background = document.createElement('canvas');
            background.width = gridSize;
            background.height = gridSize;
            const bgCtx = background.getContext('2d');
            
            // –§–æ–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º—ã
            switch(currentBackground) {
                case 'default':
                    bgCtx.fillStyle = '#0f3460';
                    break;
                case 'forest':
                    bgCtx.fillStyle = '#1B5E20';
                    break;
                case 'desert':
                    bgCtx.fillStyle = '#BF360C';
                    break;
                case 'ocean':
                    bgCtx.fillStyle = '#1E90FF';
                    break;
                case 'space':
                    bgCtx.fillStyle = '#0f0c29';
                    break;
                case 'potato':
                    bgCtx.fillStyle = '#8B4513';
                    break;
            }
            
            bgCtx.fillRect(0, 0, gridSize, gridSize);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ª–µ–≥–∫–∏–π —É–∑–æ—Ä
            bgCtx.fillStyle = 'rgba(255, 255, 255, 0.05)';
            for (let i = 0; i < 5; i++) {
                const x = Math.random() * gridSize;
                const y = Math.random() * gridSize;
                const size = Math.random() * 2 + 1;
                bgCtx.fillRect(x, y, size, size);
            }
            
            return background;
        }

        let textures = createTextures();

        // –°–æ–∑–¥–∞–µ–º –µ–¥—É
        function createFood() {
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é –µ–¥—É
            foods = [];
            
            // –°–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–ª—É—á–∞–π–Ω—ã–π —Ç–∏–ø –µ–¥—ã
            const foodTypes = [
                { type: 'apple', lengthBonus: 1, scoreBonus: 1, probability: 0.4 },
                { type: 'orange', lengthBonus: 1, scoreBonus: 1, probability: 0.2 },
                { type: 'pear', lengthBonus: 2, scoreBonus: 1, probability: 0.1 },
                { type: 'potato', lengthBonus: 5, scoreBonus: 10, probability: 0.05 },
                { type: 'coin', lengthBonus: 0, scoreBonus: 5, probability: 0.25 }
            ];
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ç–∏–ø –µ–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π
            let randomValue = Math.random();
            let cumulativeProbability = 0;
            let selectedFood = null;
            
            for (const food of foodTypes) {
                cumulativeProbability += food.probability;
                if (randomValue <= cumulativeProbability) {
                    selectedFood = food;
                    break;
                }
            }
            
            // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ (–∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è), –∏—Å–ø–æ–ª—å–∑—É–µ–º —è–±–ª–æ–∫–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if (!selectedFood) {
                selectedFood = foodTypes[0];
            }
            
            // –°–æ–∑–¥–∞–µ–º –µ–¥—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
            createFoodItem(selectedFood.type, selectedFood.lengthBonus, selectedFood.scoreBonus);
        }
        
        function createFoodItem(type, lengthBonus, scoreBonus) {
            let food = {
                x: Math.floor(Math.random() * gridWidth),
                y: Math.floor(Math.random() * gridHeight),
                type: type,
                lengthBonus: lengthBonus,
                scoreBonus: scoreBonus
            };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –µ–¥–∞ –Ω–µ –ø–æ—è–≤–ª—è–ª–∞—Å—å –Ω–∞ –∑–º–µ–π–∫–µ
            for (let segment of snake) {
                if (segment.x === food.x && segment.y === food.y) {
                    return createFoodItem(type, lengthBonus, scoreBonus);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –µ–¥–∞ –Ω–µ –ø–æ—è–≤–ª—è–ª–∞—Å—å –Ω–∞ –¥—Ä—É–≥–æ–π –µ–¥–µ
            for (let otherFood of foods) {
                if (otherFood.x === food.x && otherFood.y === food.y) {
                    return createFoodItem(type, lengthBonus, scoreBonus);
                }
            }
            
            foods.push(food);
            return food;
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function changeDirection(newDirection) {
            if (!gameRunning || gamePaused) return;
            
            const opposites = {
                'UP': 'DOWN',
                'DOWN': 'UP',
                'LEFT': 'RIGHT',
                'RIGHT': 'LEFT'
            };
            
            if (opposites[newDirection] !== direction) {
                direction = newDirection;
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—É—Ä—ã, —á—Ç–æ–±—ã —Ä–æ—Ç –±—ã–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
                textures = createTextures();
            }
        }

        // –î–≤–∏–∂–µ–Ω–∏–µ –∑–º–µ–π–∫–∏
        function moveSnake() {
            if (!gameRunning || gamePaused) return;
            
            const head = {...snake[0]};
            
            switch(direction) {
                case 'UP': head.y--; break;
                case 'DOWN': head.y++; break;
                case 'LEFT': head.x--; break;
                case 'RIGHT': head.x++; break;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏
            if (head.x < 0 || head.x >= gridWidth || head.y < 0 || head.y >= gridHeight) {
                gameOver();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π
            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    gameOver();
                    return;
                }
            }
            
            snake.unshift(head);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–µ–¥–∞–Ω–∏—è –µ–¥—ã
            let foodEaten = false;
            for (let i = 0; i < foods.length; i++) {
                const food = foods[i];
                if (head.x === food.x && head.y === food.y) {
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –∑–º–µ–π–∫–∏
                    for (let j = 0; j < food.lengthBonus; j++) {
                        snake.push({...snake[snake.length-1]});
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏
                    score += food.scoreBonus;
                    scoreElement.textContent = score;
                    
                    // –û—Å–æ–±—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –µ–¥—ã
                    if (food.type === 'coin') {
                        addCoins(food.scoreBonus);
                    }
                    
                    // –£–¥–∞–ª—è–µ–º —Å—ä–µ–¥–µ–Ω–Ω—É—é –µ–¥—É
                    foods.splice(i, 1);
                    foodEaten = true;
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –µ–¥—É
                    createFood();
                    
                    break;
                }
            }
            
            if (!foodEaten) {
                snake.pop();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∑–º–µ–π–∫–∏
            snakeLengthElement.textContent = snake.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
            if (snake.length > maxLength) {
                maxLength = snake.length;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã –≤ —Ä–µ–∂–∏–º–µ –Ω–∞ –æ—á–∫–∏
            if (currentGameMode === 'target' && score >= targetScore) {
                winGame();
                return;
            }
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Ç–µ–ø–µ—Ä—å —Å–∫–æ—Ä–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å—á–µ—Ç–∞)
            if (score > 0 && score % 50 === 0 && gameSpeed > 50) {
                gameSpeed -= 5; // –ú–µ–Ω—å—à–µ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
                clearInterval(gameInterval);
                gameInterval = setInterval(gameLoop, gameSpeed);
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
        function draw() {
            textures = createTextures();
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞ —Å —Ç–µ–∫—Å—Ç—É—Ä–æ–π
            for (let x = 0; x < gridWidth; x++) {
                for (let y = 0; y < gridHeight; y++) {
                    ctx.drawImage(textures.background, x * gridSize, y * gridSize, gridSize, gridSize);
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏
            ctx.strokeStyle = 'rgba(76, 201, 240, 0.2)';
            for (let x = 0; x < gameCanvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, gameCanvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < gameCanvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(gameCanvas.width, y);
                ctx.stroke();
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–º–µ–π–∫–∏ —Å —Ç–µ–∫—Å—Ç—É—Ä–∞–º–∏
            snake.forEach((segment, index) => {
                if (index === 0) {
                    // –ì–æ–ª–æ–≤–∞
                    ctx.drawImage(textures.snakeHead, segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                } else {
                    // –¢–µ–ª–æ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —É–∑–æ—Ä–æ–º –¥–ª—è —Ä–∞–¥—É–∂–Ω–æ–π –∑–º–µ–π–∫–∏
                    if (currentSkin === 'rainbow') {
                        const rainbowColors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#8B00FF'];
                        ctx.fillStyle = rainbowColors[index % rainbowColors.length];
                        ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                        
                        // –î–ª—è —Ä–∞–¥—É–∂–Ω–æ–π –∑–º–µ–π–∫–∏ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –≥–ª–∞–∑–∞ –Ω–∞ —Ç–µ–ª–æ
                    } else {
                        ctx.drawImage(textures.snakeBody, segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                    }
                }
            });
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –µ–¥—ã
            foods.forEach(food => {
                let texture;
                switch(food.type) {
                    case 'apple': texture = textures.apple; break;
                    case 'orange': texture = textures.orange; break;
                    case 'pear': texture = textures.pear; break;
                    case 'potato': texture = textures.potato; break;
                    case 'coin': texture = textures.coin; break;
                    default: texture = textures.apple;
                }
                ctx.drawImage(texture, food.x * gridSize, food.y * gridSize, gridSize, gridSize);
            });
        }

        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function gameOver() {
            gameRunning = false;
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –º–æ–Ω–µ—Ç—ã –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ
            if (currentGameMode === 'endless') {
                const coinsEarned = Math.floor(score / 10);
                addCoins(coinsEarned);
                coinsEarnedElement.textContent = coinsEarned;
                coinsEarnedText.style.display = 'block';
            } else {
                coinsEarnedText.style.display = 'none';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç
            if (score > maxScore) {
                maxScore = score;
            }
            
            finalScoreElement.textContent = score;
            gameOverScreen.style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
            updateLeaderboard();
            updateProfile();
        }
        
        // –ü–æ–±–µ–¥–∞
        function winGame() {
            gameRunning = false;
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –º–æ–Ω–µ—Ç—ã –∑–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            let coinsEarned = 10 + currentLevel;
            addCoins(coinsEarned);
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä—ã
            if (currentGameMode === 'target') {
                currentLevel++;
                targetScore += 10;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç
            if (score > maxScore) {
                maxScore = score;
            }
            
            winCoinsEarnedElement.textContent = coinsEarned;
            winScreen.style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
            updateLeaderboard();
            updateProfile();
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            moveSnake();
            draw();
        }

        // –°–±—Ä–æ—Å –∏–≥—Ä—ã
        function resetGame() {
            snake = [{x: Math.floor(gridWidth / 2), y: Math.floor(gridHeight / 2)}];
            direction = 'RIGHT';
            score = 0;
            scoreElement.textContent = score;
            snakeLengthElement.textContent = snake.length;
            gameSpeed = 150;
            gameRunning = true;
            gamePaused = false;
            gameOverScreen.style.display = 'none';
            winScreen.style.display = 'none';
            pauseScreen.style.display = 'none';
            coinsEarnedText.style.display = 'none';
            createFood();
            
            if (gameInterval) {
                clearInterval(gameInterval);
            }
            gameInterval = setInterval(gameLoop, gameSpeed);
            
            if (currentGameMode === 'timed') {
                timeLeft = 60;
                timerElement.textContent = timeLeft;
                startTimer();
            } else if (timerInterval) {
                clearInterval(timerInterval);
            }
        }

        // –°–≤–∞–π–ø—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        let touchStartX = 0;
        let touchStartY = 0;

        gameCanvas.addEventListener('touchstart', (event) => {
            if (controlType === 'swipe') {
                touchStartX = event.touches[0].clientX;
                touchStartY = event.touches[0].clientY;
                event.preventDefault();
            }
        });

        gameCanvas.addEventListener('touchend', (event) => {
            if (controlType === 'swipe') {
                const touchEndX = event.changedTouches[0].clientX;
                const touchEndY = event.changedTouches[0].clientY;
                
                const diffX = touchEndX - touchStartX;
                const diffY = touchEndY - touchStartY;
                
                // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–≤–∞–π–ø–∞
                const minSwipeDistance = 30;
                
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > minSwipeDistance) {
                    if (diffX > 0) {
                        changeDirection('RIGHT');
                    } else {
                        changeDirection('LEFT');
                    }
                } else if (Math.abs(diffY) > minSwipeDistance) {
                    if (diffY > 0) {
                        changeDirection('DOWN');
                    } else {
                        changeDirection('UP');
                    }
                }
                event.preventDefault();
            }
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
        function saveGameData() {
            const gameData = {
                coins: coins,
                purchasedItems: purchasedItems,
                currentLevel: currentLevel,
                currentSkin: currentSkin,
                currentBackground: currentBackground,
                language: currentLanguage,
                playerNickname: playerNickname,
                usedPromocodes: usedPromocodes,
                leaderboard: leaderboard,
                maxScore: maxScore,
                maxLength: maxLength
            };
            localStorage.setItem('snakeGameData', JSON.stringify(gameData));
        }
        
        function loadGameData() {
            const savedData = localStorage.getItem('snakeGameData');
            if (savedData) {
                const gameData = JSON.parse(savedData);
                coins = gameData.coins || 0;
                purchasedItems = gameData.purchasedItems || purchasedItems;
                currentLevel = gameData.currentLevel || 1;
                currentSkin = gameData.currentSkin || 'classic';
                currentBackground = gameData.currentBackground || 'default';
                currentLanguage = gameData.language || 'ru';
                playerNickname = gameData.playerNickname || '–ò–≥—Ä–æ–∫';
                usedPromocodes = gameData.usedPromocodes || [];
                leaderboard = gameData.leaderboard || [];
                maxScore = gameData.maxScore || 0;
                maxLength = gameData.maxLength || 0;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–∫–∏–Ω
                currentSkinIndex = availableSkins.findIndex(skin => skin.id === currentSkin);
                if (currentSkinIndex === -1) currentSkinIndex = 0;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–æ–Ω
                currentBackgroundIndex = availableBackgrounds.findIndex(bg => bg.id === currentBackground);
                if (currentBackgroundIndex === -1) currentBackgroundIndex = 0;
                
                updateCoinDisplay();
                nicknameDisplay.textContent = playerNickname;
                applyBackgroundVisual();
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫—É–ø–ª–µ–Ω–Ω—ã–µ —Ä–µ–∂–∏–º—ã
                if (purchasedItems.timedMode) {
                    document.getElementById('timedModeBtn').disabled = false;
                }
            } else {
                // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∏–∫–Ω–µ–π–º
                setTimeout(() => {
                    const nickname = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º:', '–ò–≥—Ä–æ–∫');
                    if (nickname) {
                        playerNickname = nickname;
                        nicknameDisplay.textContent = playerNickname;
                        saveGameData();
                    }
                }, 500);
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        initGame();
        createFood();
    </script>
</body>
</html>